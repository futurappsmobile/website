---
import LanguageSelector from "./LanguageSelector.astro";
import { getLegalContent } from "../i18n/utils";

interface Props {
  currentLang?: string;
}

const { currentLang = "en" } = Astro.props;
const content = await getLegalContent(currentLang);
const { header } = content;

const base = import.meta.env.BASE_URL;
// Ensure base ends with / for proper path construction
const basePath = base.endsWith("/") ? base : `${base}/`;

// Prefix links with language code
const getLink = (path: string) => {
  if (path === "") return `${basePath}${currentLang}/`; // Home
  return `${basePath}${currentLang}/${path}`;
};

const navItems = [
  { name: header.home, href: "" },
  { name: header.faq, href: "faq" },
  { name: header.support, href: "support" },
  { name: header.privacy, href: "privacy" },
  { name: header.terms, href: "terms" },
];
---

<header class="bg-white shadow-sm z-50 relative">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href={getLink("")} class="text-2xl font-bold text-blue-600">
        SnapFuel
      </a>

      <!-- Navigation Links -->
      <ul class="hidden md:flex space-x-8 items-center">
        {
          navItems.map((item) => (
            <li>
              <a
                href={getLink(item.href)}
                class="text-gray-700 hover:text-blue-600 transition-colors"
              >
                {item.name}
              </a>
            </li>
          ))
        }
        <!-- Language Selector -->
        <li>
          <LanguageSelector currentLang={currentLang} />
        </li>
      </ul>

      <!-- Mobile menu button -->
      <button
        id="mobile-menu-button"
        class="md:hidden text-gray-700"
        aria-label="Toggle menu"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden md:hidden mt-4">
      <ul class="flex flex-col space-y-2">
        {
          navItems.map((item) => (
            <li>
              <a
                href={getLink(item.href)}
                class="block py-2 text-gray-700 hover:text-blue-600 transition-colors"
              >
                {item.name}
              </a>
            </li>
          ))
        }
        <li class="py-2">
          <LanguageSelector currentLang={currentLang} />
        </li>
      </ul>
    </div>
  </nav>
</header>

<script>
  const button = document.getElementById("mobile-menu-button");
  const menu = document.getElementById("mobile-menu");

  button?.addEventListener("click", () => {
    menu?.classList.toggle("hidden");
  });
</script>
