---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { supportedLanguages } from "../../i18n/languages";
import { getLegalContent } from "../../i18n/utils";

export async function getStaticPaths() {
    return supportedLanguages.map((lang) => ({
        params: { lang: lang.code },
    }));
}

const { lang } = Astro.params;
const content = await getLegalContent(lang);
const { faq } = content;

// Helper to construct paths
const basePath = import.meta.env.BASE_URL.endsWith("/")
    ? import.meta.env.BASE_URL
    : `${import.meta.env.BASE_URL}/`;

const supportLink = `${basePath}${lang}/support`;
---

<Layout
    title={`${faq.title} - SnapFuel`}
    description="Find answers to common questions about SnapFuel, meal planning, nutrition tracking, and more."
    lang={lang}
>
    <Header currentLang={lang} />

    <main class="py-16 bg-gray-50">
        <div class="container mx-auto px-4 max-w-5xl">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                    {faq.title}
                </h1>
                <p class="text-xl text-gray-600">
                    {faq.subtitle}
                    <a
                        href={supportLink}
                        class="text-blue-600 hover:text-blue-700 underline"
                        >{faq.supportLinkText}</a
                    >.
                </p>
            </div>

            <!-- FAQ Sections -->
            {
                faq.categories.map((section) => (
                    <div class="mb-12">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6 pb-2 border-b-2 border-blue-600">
                            {section.category}
                        </h2>
                        <div class="space-y-6">
                            {section.questions.map((item) => (
                                <details class="bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                    <summary class="cursor-pointer p-6 font-semibold text-lg text-gray-900 hover:text-blue-600 transition-colors list-none flex items-center justify-between">
                                        <span>{item.question}</span>
                                        <svg
                                            class="w-5 h-5 text-blue-600 transform transition-transform duration-200"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M19 9l-7 7-7-7"
                                            />
                                        </svg>
                                    </summary>
                                    <div class="px-6 pb-6 text-gray-700 leading-relaxed">
                                        {item.answer}
                                    </div>
                                </details>
                            ))}
                        </div>
                    </div>
                ))
            }

            <!-- CTA Section -->
            <div
                class="mt-16 bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-8 text-center text-white"
            >
                <h2 class="text-3xl font-bold mb-4">{faq.ctaTitle}</h2>
                <p class="text-xl mb-6 text-blue-100">
                    {faq.ctaSubtitle}
                </p>
                <a
                    href={supportLink}
                    class="inline-block px-8 py-3 bg-white text-blue-600 rounded-lg font-semibold hover:bg-gray-100 transition-colors"
                >
                    {faq.ctaButton}
                </a>
            </div>
        </div>
    </main>

    <Footer currentLang={lang} />
</Layout>

<style>
    details[open] summary svg {
        transform: rotate(180deg);
    }
</style>
